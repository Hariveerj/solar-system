pipeline {
  agent { label 'app-server-agent' }

  environment {
    IMAGE_NAME = "hariveer/solar-system"
    IMAGE_TAG  = "${BUILD_NUMBER}"
  }

  stages {

    stage('Approval') {
      steps {
        input message: "Deploy ${IMAGE_NAME}:${IMAGE_TAG} to Kubernetes?",
              ok: "APPROVE"
      }
    }

    stage('Deploy to Kubernetes') {
      steps {
        sh '''
        kubectl apply -f deployment.yaml
        kubectl apply -f service.yaml
        kubectl rollout status deployment/solar-system
        '''
      }
    }
  }

  post {
    success {
      echo "✅ Phase-3 Deployment Successful"
    }
    failure {
      echo "❌ Phase-3 Deployment Failed"
    }
  }
}